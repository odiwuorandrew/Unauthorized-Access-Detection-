import wmi
import time
import datetime

def check_failed_logins_windows():
    c = wmi.WMI()
    unauthorized_attempts = []

    for log in c.Win32_NTLogEvent(EventCode="4625", Logfile="Security"):
        unauthorized_attempts.append(f"[{log.TimeGenerated}] Failed Login Attempt: User={log.InsertionStrings[5]}")

    if unauthorized_attempts:
        print("\n🚨 Unauthorized Access Attempts Detected! 🚨")
        for attempt in unauthorized_attempts[-5:]:  # Show last 5 failed attempts
            print(attempt)
    else:
        print("\n✅ No unauthorized login attempts detected.")

if __name__ == "__main__":
    print(f"\n🔍 Live Monitoring for Unauthorized Access... ({datetime.datetime.now()})")

    while True:
        check_failed_logins_windows()
        print("\n🔄 Waiting for new login attempts... (Refreshing in 15 sec)")
        time.sleep(15)  # Check every 15 seconds
